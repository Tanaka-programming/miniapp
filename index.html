<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF getFriendship Demo</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #status { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>LIFF getFriendship() Demo</h1>

    <div id="userInfo">
        <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <span id="userId">èª­ã¿è¾¼ã¿ä¸­...</span></p>
    </div>

    <button id="checkFriendshipButton" style="display:none;">å‹ã ã¡ã‹ç¢ºèªã™ã‚‹</button>

    <div id="friendshipStatus">
        <p>å‹ã ã¡çŠ¶æ…‹: <span id="friendStatusText">æœªç¢ºèª</span></p>
    </div>

    <div id="errorMessage" class="error"></div>
    <div id="liffError" class="error"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const userIdElement = document.getElementById('userId');
            const friendStatusTextElement = document.getElementById('friendStatusText');
            const checkFriendshipButton = document.getElementById('checkFriendshipButton');
            const errorMessageElement = document.getElementById('errorMessage');
            const liffErrorElement = document.getElementById('liffError');

            // è‡ªèº«ã®LIFF IDã«ç½®ãæ›ãˆã¦ãã ã•ã„
            const LIFF_ID = '2006882853-9aNwJ63V';

            initializeLiff();

            async function initializeLiff() {
                try {
                    await liff.init({ liffId: LIFF_ID });
                    liffErrorElement.textContent = ''; // åˆæœŸåŒ–æˆåŠŸæ™‚ã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢

                    if (!liff.isLoggedIn()) {
                        userIdElement.textContent = 'æœªãƒ­ã‚°ã‚¤ãƒ³';
                        friendStatusTextElement.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„';
                        // å¿…è¦ã§ã‚ã‚Œã°ãƒ­ã‚°ã‚¤ãƒ³ã‚’ä¿ƒã™
                        // liff.login();
                        return;
                    }

                    const profile = await liff.getProfile();
                    userIdElement.textContent = profile.userId;
                    checkFriendshipButton.style.display = 'block';

                } catch (err) {
                    console.error('LIFF Initialization failed', err);
                    userIdElement.textContent = 'LIFFåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼';
                    liffErrorElement.textContent = 'LIFFã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + JSON.stringify(err);
                }
            }

            checkFriendshipButton.addEventListener('click', async function() {
                if (!liff.isLoggedIn()) {
                    friendStatusTextElement.textContent = 'ã¾ãšLINEã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚';
                    return;
                }

                errorMessageElement.textContent = ''; // å‰ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
                friendStatusTextElement.textContent = 'ç¢ºèªä¸­...';

                try {
                    // liff.getFriendship() ã‚’å‘¼ã³å‡ºã—
                    const friendship = await liff.getFriendship();
                    console.log(friendship); // { friendFlag: true } ã¾ãŸã¯ { friendFlag: false }

                    if (friendship.friendFlag) {
                        friendStatusTextElement.textContent = 'ã‚ãªãŸã¯LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å‹ã ã¡ã§ã™ï¼ ğŸ‰';
                        friendStatusTextElement.className = 'success';
                        // ã“ã“ã§å‹ã ã¡é™å®šã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã™ã‚‹ãªã©ã®å‡¦ç†ã‚’å®Ÿè£…
                    } else {
                        friendStatusTextElement.textContent = 'ã‚ãªãŸã¯ã¾ã LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å‹ã ã¡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
                        friendStatusTextElement.className = 'error';
                        // ã“ã“ã§å‹ã ã¡è¿½åŠ ã‚’ä¿ƒã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ãªã©ã®å‡¦ç†ã‚’å®Ÿè£…
                    }
                } catch (err) {
                    console.error('Error getting friendship status:', err);
                    friendStatusTextElement.textContent = 'å‹ã ã¡çŠ¶æ…‹ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
                    friendStatusTextElement.className = 'error';
                    errorMessageElement.textContent = 'ã‚¨ãƒ©ãƒ¼: ' + err.message + (err.code ? ` (ã‚³ãƒ¼ãƒ‰: ${err.code})` : '');
                    // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã«å¿œã˜ã¦è©³ç´°ãªãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå¯èƒ½
                    // ä¾‹: err.code === 'LISDK_PERMISSION_DENIED' ã®å ´åˆã¯ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ä¸è¶³
                }
            });
        });
    </script>
</body>
</html>
